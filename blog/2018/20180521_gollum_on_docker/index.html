{
    {
        define "main"
    }
}
<main>
    <article>
    <header>
        <h1>gollum on docker</h1>
    </header>
        

<h2 id="前置き">前置き</h2>

<ul>
<li>mediawikiフォーマットで書くのに必要なwikiclothがinstallされたGollumのDockerfileが欲しい</li>
<li>探してみる

<ul>
<li>案外存在しないっぽい</li>
</ul></li>

<li><p><a href="https://hub.docker.com/r/blackglory/rugged-gollum/~/dockerfile/">https://hub.docker.com/r/blackglory/rugged-gollum/~/dockerfile/</a></p>

<ul>
<li>自分の環境が悪いせいなのか，検索ができないバグが存在した．</li>
</ul></li>

<li><p><a href="https://github.com/zachlatta/gollum-docker/blob/master/Dockerfile">https://github.com/zachlatta/gollum-docker/blob/master/Dockerfile</a></p>

<ul>
<li>コンパイルが通らなかった</li>
<li>これをbaseに書いてみた</li>
</ul></li>
</ul>

<h2 id="出来たもの">出来たもの</h2>

<ul>
<li>自分でDockerfileを書いた

<ul>
<li><a href="https://github.com/scepter914/gollum_files">https://github.com/scepter914/gollum_files</a>にアップロードした</li>
<li>ついでにconfig.rbとcustom.cssとかもここにアップロードした</li>
</ul></li>
</ul>

<pre><code>FROM ruby:2.3.1-alpine

RUN \
  # Refresh package list
  apk update \
  # Install build dependencies
  &amp;&amp; apk add --no-cache --virtual build-deps \
  # Equivalent of Debian's build-essential
    alpine-sdk \
  # Install actual dependencies
  &amp;&amp; apk add --no-cache git icu-dev libidn-dev ruby-dev\
  # add package for wikicloth
  &amp;&amp; gem install idn-ruby\
  # version
  &amp;&amp; gem install twitter-text -v &quot;1.14.7&quot;\
  # Install Gollum and associated packages
  &amp;&amp; gem install gollum github-markdown asciidoctor creole org-ruby RedCloth\
  # Install wikicloth
  &amp;&amp; gem install wikicloth \
  # Clean up build dependencies
  &amp;&amp; apk del build-deps

# Create volume at /wiki
VOLUME /wiki
WORKDIR /wiki

# Expose default gollum port 4567

ENTRYPOINT [&quot;/usr/local/bundle/bin/gollum&quot;, &quot;/wiki&quot;, &quot;--port&quot;, &quot;4567&quot;]
EXPOSE 4567

</code></pre>

<h2 id="苦労した点">苦労した点</h2>

<ul>
<li>buildが通らなかった</li>
</ul>

<pre><code>ERROR:  Error installing wikicloth:
ERROR: Failed to build gem native extension.
</code></pre>

<ul>
<li><p>wikiclothのinstallにはidn-rubyが必要で，installしたらbuildが通った</p>

<ul>
<li>参考 <a href="https://qiita.com/noraworld/items/7b8ba64d413f3f424b5b">https://qiita.com/noraworld/items/7b8ba64d413f3f424b5b</a></li>
</ul></li>

<li><p>.mediawikiで書かれたファイルが&rdquo;uninitialized constant Twitter::Autolink&rdquo;としてしか表示されない</p>

<ul>
<li><a href="https://github.com/gollum/gollum/issues/1273">https://github.com/gollum/gollum/issues/1273</a> に同じ問題が</li>
<li>twitter-textのversionを指定すると直った</li>
</ul></li>
</ul>

<h2 id="最後に">最後に</h2>

<p><a href="https://github.com/zachlatta/gollum-docker/blob/master/Dockerfile">https://github.com/zachlatta/gollum-docker/blob/master/Dockerfile</a>で，
zachlatta/gollum-dockerにDockerhubないなって思って自分でbulidしたのに，
Readme読んだら思いっきり&rdquo;docker pull zachlatta/gollum&rdquo;って書いてあるやんっていう&hellip;</p>

<p>日曜一日無駄にしてしまった&hellip;</p>

    </article>
    <aside>
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#前置き">前置き</a></li>
<li><a href="#出来たもの">出来たもの</a></li>
<li><a href="#苦労した点">苦労した点</a></li>
<li><a href="#最後に">最後に</a></li>
</ul></li>
</ul>
</nav>
    </aside>
</main>
{
    {
        end
    }
}
